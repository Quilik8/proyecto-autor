<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Usuario - A.U.T.O.R.</title>
    <link rel="stylesheet" href="css/main.css">
    <script>
      // Script para prevenir el parpadeo del tema oscuro (FOUC)
      (function() {
        try {
          var theme = localStorage.getItem('theme');
          if (theme === 'dark') {
            document.documentElement.classList.add('dark-mode');
          }
        } catch (e) { /* ignoramos errores si localStorage está desactivado */ }
      })();
    </script>
</head>
<body class="body-loading" data-page="perfil">

    <header></header>

    <main>
        <div class="profile-page-container">
            <!-- CABECERA DEL PERFIL PÚBLICO -->
            <div class="profile-header">
                <img src="https://placehold.co/150x150/80E9D9/1a1a1a?text=Avatar" alt="Avatar de usuario" class="profile-avatar">
                <div class="profile-info">
                    <h1 id="profile-username">Cargando...</h1>
                    <p id="profile-email" class="hidden">Cargando...</p>
                    <p id="profile-bio" style="font-size: 16px; margin-top: 10px;"></p>
                    <div id="profile-roles-container" style="margin-top: 15px;">
                        <!-- Las etiquetas de los roles se cargarán aquí -->
                    </div>
                    <a href="editar-perfil.html" id="edit-profile-btn" class="cta-button hidden" style="margin-top: 10px; padding: 8px 20px;">Editar Perfil</a>
                    <button id="propose-collab-btn" class="cta-button secondary hidden" style="margin-top: 10px; padding: 8px 20px;">Proponer Colaboración</button>
                    <button id="send-message-btn" class="cta-button hidden" style="margin-top: 10px; padding: 8px 20px;">Enviar Mensaje</button>
                </div>
            </div>

            <!-- SISTEMA DE PESTAÑAS PÚBLICAS -->
            <div class="profile-tabs">
                <button class="tab-link active" data-tab="tab-obras">Obras</button>
                <button class="tab-link" data-tab="tab-bitacora">Bitácora</button>
                <button class="tab-link" data-tab="tab-portafolio">Portafolio</button>
                <button class="tab-link" data-tab="tab-reseñas">Reseñas</button>
                <button class="tab-link" data-tab="tab-actividad">Actividad</button>
            </div>

            <!-- CONTENIDO DE LAS PESTAÑAS PÚBLICAS -->
            <div class="profile-content">

                <div id="tab-obras" class="tab-content active">
                    <!-- El contenido de las obras públicas se cargará aquí con JavaScript -->
                </div>

                <div id="tab-bitacora" class="tab-content">
                    <h2>Bitácora del Creador</h2>
                    <div id="bitacora-feed-container">
                        <!-- Las entradas de la bitácora se cargarán aquí -->
                    </div>
                </div>

                <div id="tab-portafolio" class="tab-content">
                    <div class="portfolio-actions hidden" id="portfolio-actions-container">
                        <button id="add-portfolio-item-btn" class="cta-button">Añadir al Portafolio</button>
                    </div>
                    <form id="portfolio-form" class="portfolio-form hidden">
                        <h3 id="portfolio-form-title">Añadir al Portafolio</h3>
                        <input type="hidden" id="portfolio-item-id">
                        <div class="form-group">
                            <label for="portfolio-title">Título del Trabajo</label>
                            <input type="text" id="portfolio-title" placeholder="Ej: Diseño de Portada para 'El Último Dragón'" required>
                        </div>
                        <div class="form-group">
                            <label for="portfolio-description">Descripción</label>
                            <textarea id="portfolio-description" rows="4" placeholder="Describe tu contribución, el proyecto, etc." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="portfolio-link">Enlace al Trabajo (Opcional)</label>
                            <input type="url" id="portfolio-link" placeholder="https://...">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="cta-button">Guardar Trabajo</button>
                            <button type="button" id="cancel-portfolio-form-btn" class="cta-button secondary">Cancelar</button>
                        </div>
                        <p id="portfolio-form-error" class="error-message"></p>
                    </form>
                    <div id="portfolio-items-container">
                        <!-- Los ítems se cargarán aquí con JavaScript -->
                        <p>Cargando portafolio...</p>
                    </div>
                </div>

                <div id="tab-reseñas" class="tab-content">
                    <form id="review-form" class="review-form hidden">
                        <h3>Dejar una Reseña</h3>
                        <div class="form-group">
                            <label>Valoración</label>
                            <div class="star-rating">
                                <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5 estrellas">★</label>
                                <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 estrellas">★</label>
                                <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 estrellas">★</label>
                                <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 estrellas">★</label>
                                <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 estrella">★</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="review-comment">Comentario</label>
                            <textarea id="review-comment" rows="4" placeholder="Describe tu experiencia colaborando con este usuario..." required></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="cta-button">Publicar Reseña</button>
                        </div>
                        <p id="review-form-error" class="error-message"></p>
                    </form>
                    <div id="reviews-list-container">
                        <p>Cargando reseñas...</p>
                    </div>
                </div>

                <div id="tab-actividad" class="tab-content">
                    <h2>Actividad Reciente</h2>
                    <p>Próximamente: La actividad reciente de este usuario.</p>
                </div>
            </div>
        </div>

    </main>

    <footer></footer>
            <!-- Modal para proponer colaboración -->
<div id="collab-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <h3>Proponer Colaboración</h3>
        <p>Selecciona una de tus obras y define los términos de la colaboración.</p>
        
        <form id="collab-proposal-form">
            <div class="form-group">
    <label for="collab-story-select">Obra para la Colaboración</label>
    <select id="collab-story-select" required>
        <option value="">Cargando tus obras...</option>
    </select>
</div>
<div class="form-group">
    <label for="collab-role-input">Rol del Colaborador</label>
    <input type="text" id="collab-role-input" placeholder="Ej: Editor, Diseñador de Portada" required>
</div>

<hr class="form-divider">

<!-- === SECCIÓN DE PAGO FIJO === -->
<div class="form-group">
    <label for="collab-fixed-payment">Pago Fijo (Opcional)</label>
    <input type="number" id="collab-fixed-payment" placeholder="0.00" min="0" step="0.01">
    <p class="form-hint">Introduce 0 si no hay pago por adelantado. Este monto será retenido en garantía.</p>
</div>

<hr class="form-divider">

<!-- === SECCIÓN DE REPARTO POR ETAPAS === -->
<h4 class="form-section-title">Reparto de Ganancias (Opcional)</h4>
<div class="form-group">
    <label for="collab-initial-share">1. Porcentaje de Reparto Inicial (%)</label>
    <input type="number" id="collab-initial-share" placeholder="0.00" min="0" max="100" step="0.01">
    <p class="form-hint">El porcentaje que recibirá el colaborador de todos los ingresos de la obra.</p>
</div>
<div class="form-group">
    <label for="collab-share-cap">2. Aplicar este porcentaje hasta que el colaborador gane ($)</label>
    <input type="number" id="collab-share-cap" placeholder="0.00" min="0" step="0.01">
    <p class="form-hint">El reparto cambiará después de que el colaborador haya ganado esta cantidad. Introduce 0 para que el reparto inicial sea indefinido.</p>
</div>
<div class="form-group">
    <label for="collab-post-cap-share">3. Porcentaje de Reparto Posterior (%)</label>
    <input type="number" id="collab-post-cap-share" placeholder="0.00" min="0" max="100" step="0.01">
    <p class="form-hint">El nuevo porcentaje después de alcanzar el límite. Introduce 0 si el reparto termina.</p>
</div>

<div class="form-actions">
    <button type="submit" class="cta-button">Enviar Propuesta</button>
</div>
<p id="collab-form-error" class="error-message"></p>
        </form>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="scripts/main.js"></script>
</body>
</html>